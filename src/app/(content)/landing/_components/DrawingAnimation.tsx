"use client"

import React, { useRef } from "react"
import gsap from "gsap"

import { MdKeyboardDoubleArrowDown } from "react-icons/md"

import { useGSAP } from "@gsap/react"

gsap.registerPlugin(useGSAP)

const AnimatedMotionDrawing: React.FC = () => {
  const pathRef = useRef<SVGPathElement>(null)
  const textRef = useRef<HTMLDivElement>(null)
  const introTextRef = useRef<HTMLDivElement>(null)
  const arrowRef = useRef<HTMLDivElement>(null)
  const beforeWordRef = useRef<HTMLDivElement>(null)
  const afterWordRef = useRef<HTMLDivElement>(null)

  useGSAP(() => {
    if (pathRef.current) {
      const pathLength = pathRef.current.getTotalLength()

      // Animate the path drawing
      gsap.set(pathRef.current, {
        strokeDasharray: pathLength,
        strokeDashoffset: pathLength,
      })

      const tl = gsap.timeline()
      tl.to(pathRef.current, {
        strokeDashoffset: 0,
        duration: 2.5,
        ease: "expo.in",
      })
        .fromTo(
          textRef.current,
          {
            opacity: 0,
            x: 300,
          },
          {
            x: 0,
            y: 0,
            opacity: 1,
            duration: 1,
            ease: "bounce.out",
          },
          "+=0.2"
        )
        .to(
          pathRef.current,
          {
            // x: "-100%",
            // y: "50%",
            // scale: 0.2,
            opacity: 0,
            duration: 2,
            ease: "power4.out",
          },
          "<+0.3"
        )

        .add("textSwapGroup")
        .to(
          beforeWordRef.current,
          {
            x: "100%",
            duration: 1,
          },
          "textSwapGroup"
        )
        .fromTo(
          afterWordRef.current,
          { x: "-100%" },
          {
            x: 0,
            duration: 1,
          },
          "textSwapGroup"
        )

        .fromTo(
          arrowRef.current,
          { opacity: 0 },
          {
            opacity: 1,
            ease: "power1.inOut",
          },
          "+=0.2"
        )
        .fromTo(
          introTextRef.current,
          { opacity: 0, y: -10 },
          {
            opacity: 1,
            y: 0,
            ease: "power1.inOut",
          },
          "<=0"
        )
        .to(
          arrowRef.current,
          {
            y: -20,
            duration: 0.5,
            ease: "power1.out",
            yoyo: true,
            repeat: -1,
          },
          "<=0"
        )

      gsap.to(arrowRef.current, {
        ease: "power1.inOut",
        scrollTrigger: {
          trigger: arrowRef.current,
          start: "top 70%",
          end: "bottom top",
          scrub: 1,
          onEnter: () =>
            gsap.to(arrowRef.current, { opacity: 0, duration: 0.6 }),
          onLeave: () =>
            gsap.to(arrowRef.current, { opacity: 1, duration: 0.6 }),
          onEnterBack: () =>
            gsap.to(arrowRef.current, { opacity: 0, duration: 0.6 }),
          onLeaveBack: () =>
            gsap.to(arrowRef.current, { opacity: 1, duration: 0.6 }),
          // markers: true,
        },
      })
    }
  }, [])

  return (
    <div className="h-full">
      <div className="absolute top-0 left-0 w-full h-4/5 md:h-[80dvh] flex justify-center items-center">
        <svg
          data-name="messyLline"
          xmlns="http://www.w3.org/2000/svg"
          width="100%"
          height="100%"
          viewBox="0 0 800 800"
          className="mt-0 md:mt-22"
        >
          <path
            ref={pathRef}
            stroke="black"
            strokeWidth="1"
            fill="none"
            d="M.98,376.48c4.61-18.02,13.8-34.78,26.44-48.44,6.36-6.87,13.61-13.18,21.66-17.99,8.51-5.09,18.81-8.7,28.74-6.02,15.79,4.26,22.7,21.26,27.28,35.34,2.79,8.6,5.16,17.32,8.22,25.83,3.36,9.35,7.22,18.53,11.54,27.48,8.75,18.12,19.42,35.3,31.78,51.18,1.51,1.94,3.05,3.85,4.6,5.75.26.31.72.1.84-.22,7.97-22.62,13.16-46.19,15.51-70.06,2.35-23.87,1.87-48-1.46-71.75-1.87-13.35-4.65-26.57-8.31-39.54-.13-.46-.85-.49-.96,0-4.76,21.42-8,43.17-9.69,65.04-1.69,21.91-1.82,43.94-.39,65.87.8,12.29,2.11,24.54,3.88,36.73.07.48.69.42.91.12,13.77-18.57,25.05-39.35,30.74-61.86,5.33-21.06,5.39-43.49-1.42-64.23-3.71-11.32-9.48-21.93-17.25-30.98l-.61.79c12,8.71,21.55,20.39,28.35,33.53,6.86,13.27,10.98,27.92,12.64,42.74,1.74,15.58.66,31.28-2.71,46.57-3.79,17.15-10.23,33.61-18.22,49.22-8.05,15.75-17.64,30.66-27.92,45.04-1.26,1.76-2.53,3.52-3.81,5.27l.93.25c1.51-29.03,2.72-58.07,3.61-87.12.89-28.89,1.47-57.78,1.74-86.68.15-16.28.21-32.55.17-48.83l-.85.35c15.72,17.96,26.4,39.98,31.67,63.21s5.18,47.74-.57,70.87c-3.21,12.93-8.21,25.38-14.95,36.88-.3.51.37.97.79.61,19.63-17.12,33.2-40.87,38.35-66.38,5.17-25.65,1.27-52.48-10.42-75.84-6.59-13.17-15.59-25.13-26.54-34.99-.43-.39-1.04.09-.79.61,9.98,20.06,21.46,39.34,33.88,57.97,12.39,18.59,25.7,36.55,39.4,54.19,13.82,17.81,28.05,35.29,42.2,52.84,14.17,17.57,28.28,35.2,41.84,53.25,13.45,17.92,26.36,36.27,38.18,55.31,1.48,2.39,2.94,4.79,4.39,7.19.33.55,1.19.05.86-.5-11.22-19.05-16.54-40.67-21.59-61.99-5.01-21.17-10.06-42.42-20.04-61.91s-22.6-35.32-37.04-50.43c-14.8-15.49-31.08-29.48-47.51-43.19-8.2-6.84-16.34-13.82-25.18-19.84-8.71-5.94-18.29-11.01-28.72-13.05-2.46-.48-4.95-.78-7.45-.92-.47-.03-.72.74-.25.93,18.77,7.93,36.75,17.66,53.7,28.96,16.91,11.28,32.78,24.11,47.4,38.23,14.72,14.22,28.17,29.75,40.15,46.34,11.85,16.42,22.25,33.88,31,52.14,8.84,18.44,15.97,37.69,21.19,57.46.63,2.4,1.24,4.82,1.82,7.23.15.64,1.05.35.96-.27-3.12-22.28-8.72-44.18-16.57-65.26s-17.82-41.19-29.72-60.18c-11.91-19.01-25.72-36.83-41.15-53.12s-32.45-31.01-50.83-43.85c-18.36-12.83-38.07-23.75-58.75-32.37-2.6-1.08-5.21-2.13-7.84-3.14-.31-.12-.63.19-.63.48-.6,23.93,5.27,47.42,13.41,69.76,8.06,22.12,17.96,43.63,28.19,64.81,10.16,21.04,21.05,41.74,32.63,62.03,11.58,20.3,23.87,40.19,36.82,59.64,12.95,19.45,26.57,38.46,40.83,56.97,1.68,2.18,3.37,4.36,5.07,6.53l.71-.71c-16.04-13.96-29.9-30.36-41.04-48.47-11.25-18.29-19.68-38.25-24.9-59.09-5.86-23.41-8.02-47.51-11.67-71.32-1.82-11.87-4.01-23.7-7.23-35.28-3.11-11.22-7.28-22.1-12.27-32.61-10.05-21.14-23.12-40.65-36.43-59.84-1.62-2.34-3.25-4.68-4.88-7.01l-.43.75c25.58,2.21,50.99,6.39,75.92,12.52,24.68,6.06,48.89,13.99,72.36,23.74,10.67,4.43,21.77,9.3,29.52,18.19s11,20,13.57,30.97c5.91,25.23,9.15,51.13,9.92,77.03.78,26.21-1.02,52.5-5.43,78.35-.54,3.14-1.11,6.27-1.72,9.4h.96c-3.38-17.29-7.19-34.5-11.41-51.61s-8.87-34.11-13.93-50.99c-5.06-16.88-10.52-33.64-16.39-50.25-5.87-16.61-12.14-33.09-18.81-49.39-6.6-16.14-13.59-32.13-20.95-47.93-7.44-15.97-15.28-31.76-23.49-47.35-8.21-15.59-16.81-30.98-25.77-46.15-9.31-15.75-19.04-31.25-29.11-46.54-10.4-15.79-21.14-31.36-32.06-46.79-10.97-15.51-22.13-30.88-33.32-46.23-2.75-3.77-5.5-7.54-8.26-11.31l-.79.61c13.09,12.24,25.61,25.07,37.57,38.41s23.38,27.22,34.25,41.48,21.12,28.83,30.92,43.77,19.22,30.38,28.12,45.98,17.3,31.36,25.33,47.36c8.55,17.05,16.64,34.34,24.36,51.78,8.07,18.24,15.73,36.67,23.07,55.22,7.3,18.45,14.29,37.03,21.05,55.68,6.8,18.74,13.37,37.57,19.82,56.43,6.43,18.79,12.73,37.62,19,56.46,1.54,4.61,3.07,9.23,4.61,13.84l.48-.63c-25.16-1.01-48.64-11.68-68.94-26.06-20.39-14.45-38.18-32.56-54.19-51.66s-30.07-39.74-42.09-61.53c-12.02-21.8-21.96-44.75-29.62-68.43-7.7-23.8-13.12-48.36-16.02-73.21-.35-2.98-.66-5.96-.93-8.95l-.75.43c26.9,14,53.81,28,80.71,42,26.76,13.92,53.51,27.85,80.27,41.77,26.9,14,53.81,28,80.71,42,26.76,13.92,53.51,27.85,80.27,41.77,26.9,14,53.81,28,80.71,42,3.25,1.69,6.5,3.38,9.76,5.08l.39-.91c-18.71-3.06-37.39-6.34-56.02-9.86-18.55-3.5-37.06-7.23-55.53-11.19s-37.03-8.18-55.47-12.62c-18.44-4.43-36.82-9.1-55.14-13.99-18.24-4.87-36.43-9.96-54.54-15.28s-36.32-10.9-54.38-16.69-35.89-11.75-53.72-17.96c-17.71-6.16-35.36-12.52-52.85-19.28-17.56-6.78-34.96-13.98-52.08-21.8-8.47-3.87-16.86-7.89-25.17-12.09-4.15-2.1-8.29-4.24-12.39-6.43-3.41-1.82-6.8-3.73-9.54-6.51-2.51-2.55-4.27-5.83-3.27-9.46l-.48.37c28.51,1.01,55.65,11.29,81,23.68,21.35,10.44,41.95,22.46,61.47,36.02s37.73,28.47,54.54,45.05c16.6,16.36,31.73,34.27,44.68,53.66s23.52,39.86,31.33,61.6c3.88,10.8,7.23,21.91,9.44,33.18,2.21,11.31,3.18,23.57-.46,34.7-1.76,5.38-4.7,10.33-8.8,14.24s-9.31,6.66-14.79,8.27c-11.34,3.33-23.58,2.37-35.04.17-22.13-4.25-43.12-13.27-61.9-25.65-19.02-12.54-35.75-28.41-49.95-46.17-14.38-17.99-26.25-37.99-35.36-59.13-11.14-25.83-18.45-53.43-21.97-81.32-3.25-25.71-3.57-52.09,1.31-77.62,4.58-23.95,13.98-47.32,30.13-65.86,14.3-16.41,34.28-27.53,55.68-31.41,20.74-3.76,43.15-.24,59.93,13.12,19.5,15.52,28.56,40.08,35,63.33,7.96,28.7,13.17,58.11,16.9,87.64s6.09,59.57,8.17,89.42,3.81,61.34,5.03,92.04c1.22,30.7,1.97,61.43,2.27,92.15.14,14.78.18,29.56.11,44.35h1c-.81-27.49,2.79-54.9,8.9-81.66,6.13-26.84,14.7-53.06,23.94-78.97,8.54-23.94,17.62-47.69,27.21-71.23s19.75-46.97,30.39-70.11c10.6-23.05,21.7-45.87,33.29-68.43,11.59-22.57,23.68-44.88,36.24-66.92,12.56-22.04,25.61-43.81,39.12-65.28s27.49-42.65,41.92-63.52,29.32-41.41,44.66-61.62c15.4-20.29,31.24-40.25,47.52-59.84,3.91-4.71,7.85-9.4,11.81-14.07l-.49.13c5.47,1.83,10.95,3.66,16.42,5.48l-.35-.62c-5.23,19.5-10.55,38.98-15.94,58.44-5.4,19.46-10.88,38.89-16.44,58.3-5.56,19.41-11.2,38.8-16.93,58.16s-11.48,38.55-17.34,57.78-11.85,38.61-17.9,57.87c-6.05,19.27-12.18,38.51-18.39,57.72-3.1,9.61-6.23,19.21-9.37,28.8-2.31,7.04-5.02,14.12-9.78,19.91-2.04,2.48-4.49,4.73-7.44,6.07-1.49.68-3.09,1.1-4.73,1.2-.77.05-1.54.03-2.31-.05-.63-.07-.72,0-.94-.56-.25-.65-.3-1.52-.44-2.2-1.97-9.96-3.94-19.92-5.9-29.88-3.97-20.08-7.93-40.16-11.9-60.25-3.97-20.08-7.93-40.16-11.9-60.25-.97-4.9-1.94-9.8-2.9-14.69-.09-.46-.68-.43-.91-.12-12.5,17.18-23.97,35.1-34.35,53.64-10.29,18.39-19.49,37.38-27.57,56.84-8.12,19.55-15.08,39.59-20.85,59.96-2.89,10.22-5.48,20.53-7.75,30.9-2.09,9.52-4.55,19.41-3.84,29.23.64,8.82,4.54,16.9,12.24,21.62,7.29,4.47,16.33,5.56,24.72,4.98,17.96-1.25,34.9-9.14,49.12-19.89,14.76-11.17,27.04-25.31,37.85-40.25,12.01-16.61,22.6-34.38,32.18-52.49,9.92-18.76,18.56-38.23,25.18-58.4,6.62-20.15,11.22-41.03,12.97-62.19,1.35-16.34.21-33.5-5.68-48.93-5.56-14.58-16.15-27.33-31.42-32.13s-32.54-.22-45.72,8.75c-6.84,4.66-12.87,10.5-17.73,17.2-5.46,7.54-9.12,16.18-11.5,25.14-5.47,20.6-3.96,42.35-.56,63.16s8.29,41.23,13.83,61.46,12.01,40.31,19.32,60.02c7.25,19.55,15.36,38.78,24.27,57.63,8.96,18.94,18.74,37.49,29.32,55.58,10.57,18.09,21.94,35.71,34.06,52.8,5.82,8.2,11.81,16.27,17.96,24.21.39.51,1.1Z"
            className="translate-x-10 translate-y-20 md:translate-y-10"
          />
        </svg>
      </div>
      <div
        ref={textRef}
        lang="en"
        className=" absolute top-10 left-0 font-bold text-5xl sm:text-6xl xl:text-7xl w-full h-4/5 flex flex-col justify-center items-center"
      >
        <div className="w-full h-fit flex-1"/>
        <div className="w-9/10 md:w-4/5 lg:w-3/5 h-max overflow-hidden font-medium">
          <div className="w-full h-fit flex justify-center">MAKE YOUR</div>
          <div className=" w-full block relative h-30 md:h-16 ">
            <div
              ref={beforeWordRef}
              className=" w-full flex flex-col md:flex-row absolute h-full md:gap-4 justify-evenly md:justify-center items-center"
            >
              <div className="block md:inline">JOURNEY </div>
              <div className="block md:inline"> EASIER</div>
            </div>
            <div
              ref={afterWordRef}
              className=" w-full flex flex-col md:flex-row absolute h-full md:gap-4 justify-evenly md:justify-center items-center"
            >
              <div className="block md:inline">HEADACHE </div>
              <div className="block md:inline"> LESS</div>
            </div>
          </div>
          <div className="w-full h-fit flex justify-center">WITH US</div>
        </div>
        <div className="w-full h-fit flex-1 flex justify-center items-center">
          <div ref={introTextRef} className="">
            <div className="text-center text-lg md:text-xl xl:text-2xl w-full">
              <div>Do you have an idea </div>
              <div>to start your business in Berlin?</div>
            </div>
          </div>
        </div>
        <div ref={arrowRef} className="absolute -bottom-14 md:-bottom-16">
          <MdKeyboardDoubleArrowDown className="text-3xl" />
        </div>
      </div>
    </div>
  )
}

export default AnimatedMotionDrawing
